# HOMER Deployment

This repository contains the configuration and deployment script for setting up HOMER 7.7 with additional services (Grafana, Prometheus, Loki, NGINX as a reverse proxy, and Heplify as a HEP capture agent) using Docker Compose. The deployment is fully automated via a single script, making it easy to deploy on a production server with minimal manual effort.

## Prerequisites

- A Linux server (Ubuntu recommended) with internet access.
- Root or sudo privileges on the server.

## Deployment Instructions

Follow these steps to deploy HOMER and its associated services on a production server:

1. **Clone the repository:**
   ```bash
   git clone https://github.com/valandvir/homer-deployment.git
   
2. **Navigate to the directory:**
   ```bash
   cd homer-deployment

4. **Make the deployment script executable:**
   ```bash
   sudo chmod +x deploy.sh
   
5. **Run the deployment script:**
   ```bash
   sudo ./deploy.sh

When prompted, enter the name of the CAPTURE interface (e.g., ens192) or press Enter to use the default value (ens192).

The script will:
Install Docker and the Docker Compose plugin if not already present.
Create the required directory structure (/opt/homer/).
Generate self-signed SSL certificates for NGINX.
Download the homer7-docker repository.
Copy modified configuration files from this repository.
Set up environment variables in .env.
Start all services using Docker Compose.

## Verification
After the deployment script completes, verify the setup:

1. **Check the generated .env file:**
   ```bash
   cat /opt/homer/homer7-docker/heplify-server/hom7-prom-all/.env

Expected output:
```
CAPTURE_INTERFACE=ens192
SERVER_HOSTNAME=<your_FQDN>
HOMER_DST=127.0.0.1
<your_FQDN> will be the fully qualified domain name of your server (e.g., prod.example.com), automatically determined by hostname -f.
```

2. **Verify that services are running:**
   ```bash
   sudo docker compose ps

This should list all services (e.g., heplify, nginx, homer-webapp, etc.) with a status of Up.

Repository Contents
docker-compose.yml: Modified Docker Compose configuration with added heplify and nginx services.
default.conf.template: NGINX configuration template for reverse proxying HOMER and Grafana over HTTPS.
deploy.sh: Deployment script that automates the entire setup process.

## Notes
Ensure your server's hostname is correctly configured (check with hostname -f) as it is used for the SERVER_HOSTNAME variable and SSL certificate generation.
The CAPTURE interface (ens192 by default) should match the network interface on your production server used for capturing traffic with Heplify.
Self-signed certificates are generated by default. For production use, consider replacing them with valid certificates (e.g., from Let's Encrypt).

## Troubleshooting
If you encounter errors like $'\r': command not found, ensure the script uses LF line endings (run dos2unix deploy.sh or recreate it on Linux).
If services fail to start, check logs with sudo docker logs <container_name> (e.g., sudo docker logs heplify).
Contributing
Feel free to submit issues or pull requests to improve this deployment setup.

### License
This project is licensed under the MIT License.

### Acknowledgments
Based on the official homer7-docker repository: https://github.com/sipcapture/homer7-docker.
Thanks to the HOMER community for providing a robust SIP capture solution.
